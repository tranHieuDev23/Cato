<div class="content">
    <button *ngIf="sessionAccount?.role === 'admin' || sessionAccount?.role === 'problem_setter'" nz-button
        class="create-test-case-button" (click)="onCreateTestCaseClicked()">
        Create test case
    </button>
    <nz-table #table [nzData]="testCaseList" [nzPageIndex]="pageIndex" [nzPageSize]="pageSize"
        [nzTotal]="totalTestCaseCount" [nzLoading]="loading" [nzShowSizeChanger]="true"
        [nzPageSizeOptions]="[10, 20, 50, 100]" (nzPageIndexChange)="onPageIndexChange($event)"
        (nzPageSizeChange)="onPageSizeChange($event)">
        <thead>
            <tr>
                <th>#</th>
                <th>Input</th>
                <th>Output</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let testCase of table.data; index as i">
                <td>{{ testCase.id }}</td>
                <td>
                    @if (testCase.isHidden && sessionAccount?.role === 'contestant') {
                    Hidden
                    } @else {
                    <code nz-typography [nzContent]="testCase.input | ellipsis:100 " nz-tooltip="Click to copy"
                        (click)="onTestCaseInputClicked(i, testCase)">
                    </code>
                    }
                </td>
                <td>
                    @if (testCase.isHidden && sessionAccount?.role === 'contestant') {
                    Hidden
                    } @else {
                    <code nz-typography [nzContent]="testCase.output | ellipsis:100" nz-tooltip="Click to copy"
                        (click)="onTestCaseOutputClicked(i, testCase)">
                    </code>
                    }
                </td>
                <td>
                    <nz-button-group>
                        <button nz-button [disabled]="testCase.loading" nz-tooltip="Expand"
                            (click)="onTestCaseExpandClicked(i, testCase)">
                            <span nz-icon nzType="expand-alt" nzTheme="outline"></span>
                        </button>
                        <button *ngIf="sessionAccount?.role === 'admin' || sessionAccount?.role === 'problem_setter'"
                            nz-button [disabled]="testCase.loading" nz-tooltip="Edit"
                            (click)="onTestCaseEditClicked(i, testCase)">
                            <span nz-icon nzType="edit" nzTheme="outline"></span>
                        </button>
                        <button *ngIf="sessionAccount?.role === 'admin' || sessionAccount?.role === 'problem_setter'"
                            nz-button [disabled]="testCase.loading" nz-tooltip="Delete" nzDanger
                            (click)="onTestCaseDeleteClicked(testCase)">
                            <span nz-icon nzType="delete" nzTheme="outline"></span>
                        </button>
                    </nz-button-group>
                </td>
            </tr>
        </tbody>
    </nz-table>
    <ng-template #expandTestCaseModal>
        <div class="edit-test-case-modal">
            <p nz-typography>Input</p>
            <ngx-codemirror class="editor" [(ngModel)]="expandTestCaseModalInput"
                [options]="{theme: 'material', mode: 'text/plain', autoRefresh: true, readOnly: true}">
            </ngx-codemirror>
            <br />
            <p nz-typography>Output</p>
            <ngx-codemirror class="editor" [(ngModel)]="expandTestCaseModalOutput"
                [options]="{theme: 'material', mode: 'text/plain', autoRefresh: true, readOnly: true}">
            </ngx-codemirror>
        </div>
    </ng-template>
    <ng-template #expandTestCaseModalFooter>
        <button nz-button (click)="onExpandTestCaseModalCopyInputClicked()">
            <span nz-icon nzType="copy" nzTheme="outline"></span> Copy input
        </button>
        <button nz-button (click)="onExpandTestCaseModalCopyOutputClicked()">
            <span nz-icon nzType="copy" nzTheme="outline"></span> Copy output
        </button>
    </ng-template>
    <ng-template #editTestCaseModal>
        <div class="edit-test-case-modal">
            <p nz-typography>Input</p>
            <ngx-codemirror class="editor" [(ngModel)]="editTestCaseModalInput"
                [options]="{theme: 'material', mode: 'text/plain', autoRefresh: true}">
            </ngx-codemirror>
            <br />
            <p nz-typography>Output</p>
            <ngx-codemirror class="editor" [(ngModel)]="editTestCaseModalOutput"
                [options]="{theme: 'material', mode: 'text/plain', autoRefresh: true}">
            </ngx-codemirror>
            <br />
            <label nz-checkbox [(ngModel)]="editModalTestCaseIsHidden">Is hidden</label>
        </div>
    </ng-template>
</div>